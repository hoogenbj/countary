/*
 * This file was generated by the Gradle 'init' task.
 */
plugins {
    id 'org.openjfx.javafxplugin' version '0.0.13'
    id 'org.beryx.jlink' version '2.26.0'
    id 'application'
}

repositories {
    mavenCentral()
}

javafx {
    version = "20"
    modules = ['javafx.controls', 'javafx.graphics', 'javafx.fxml', 'javafx.swing']
}

dependencies {
    implementation(group: 'za.co.clock24', name: 'DsvParser', version: '2.0.1')
    implementation(group: 'org.xerial', name: 'sqlite-jdbc', version: '3.36.0.3')
    implementation(group: 'com.google.inject', name: 'guice', version: '5.1.0')
    implementation(group: 'org.controlsfx', name: 'controlsfx', version: '11.1.2') { transitive = false }
    implementation(group: 'org.apache.commons', name: 'commons-text', version: '1.10.0')
    implementation 'commons-io:commons-io:2.11.0'
    testImplementation 'org.hamcrest:hamcrest:2.2'
    testImplementation 'org.hamcrest:hamcrest-library:2.2'
    testImplementation 'org.hamcrest:hamcrest-core:2.2'
    testImplementation(group: 'org.jmock', name: 'jmock-junit5', version: '2.12.0') {
        exclude group: "com.google.code.findbugs", module: "annotations"
        exclude group: "org.hamcrest"
    }
    testImplementation("org.junit.jupiter:junit-jupiter:5.9.1")
}

test {
    useJUnitPlatform()
}

application {
    mainModule.set('hoogenbj.countary')
    mainClass.set('hoogenbj.countary.app.CountaryApp')
}

ext.os = org.gradle.internal.os.OperatingSystem.current()

jlink {
    options = ['--compress', '2', '--no-header-files', '--no-man-pages', '--ignore-signing-information']
    launcher {
        name = 'Countary'
    }
    jpackage {
        if (os.macOsX) {
            installerType = "dmg"
            outputDir = 'my-packaging'
            imageOptions = ['--icon', 'src/main/resources/hoogenbj/countary/app/countary.icns']
            installerOptions = ['--mac-package-identifier', "hoogenbj.Countary",
                                '--mac-package-name', "Countary"
            ]
        } else if (os.windows) {
            installerType = "msi"
            imageOptions = ['--icon', 'src/main/resources/hoogenbj/countary/app/countary.ico']
            installerOptions = ['--win-per-user-install', '--win-dir-chooser', '--win-menu',
                                '--win-upgrade-uuid', 'c7d18706-9e31-4cf0-a5b1-bc5ed34b4315']
        }
        installerOptions += '--name'
        installerOptions += 'Countary'
        installerOptions += '--vendor'
        installerOptions += 'Johan Hoogenboezem'
        installerOptions += '--dest'
        installerOptions += "product"
        installerOptions += '--verbose'
        installerOptions += '--app-version'
        installerOptions += "$version"
        installerOptions += '--license-file'
        installerOptions += '../LICENSE'
        installerOptions += '--copyright'
        installerOptions += 'JA Hoogenboezem 2023'
        installerOptions += '--description'
        installerOptions += "Countary - an opinionated budgeting program"
    }
}
